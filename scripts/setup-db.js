/* eslint-disable @typescript-eslint/no-require-imports */
const fs = require("fs");
const path = require("path");

const isProd = process.env.NODE_ENV === "production" || process.env.VERCEL === "1";
const schemaPath = path.join(__dirname, "../prisma/schema.prisma");

console.log(`üîß Configurando base de datos para: ${isProd ? "PRODUCCI√ìN" : "DESARROLLO"}`);

try {
  // Leer el schema actual
  const schemaContent = fs.readFileSync(schemaPath, "utf8");

  // Configurar provider y url seg√∫n el entorno
  let updatedSchema = schemaContent;

  if (isProd) {
    // Configuraci√≥n para PostgreSQL en producci√≥n
    updatedSchema = updatedSchema.replace(/provider\s*=\s*"sqlite"/g, 'provider = "postgresql"');
    console.log("‚úÖ Configurado para PostgreSQL (Producci√≥n)");
  } else {
    // Configuraci√≥n para SQLite en desarrollo
    updatedSchema = updatedSchema.replace(/provider\s*=\s*"postgresql"/g, 'provider = "sqlite"');
    console.log("‚úÖ Configurado para SQLite (Desarrollo)");
  }

  // Escribir el schema actualizado
  fs.writeFileSync(schemaPath, updatedSchema);

  console.log("üìÑ Schema actualizado correctamente");
} catch (error) {
  console.error("‚ùå Error configurando base de datos:", error.message);
  process.exit(1);
}
